@model GestaoSaudeIdosos.Web.ViewModels.DashboardViewModel
@{
    ViewData["Title"] = "Home";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="layout-container">
    <div class="header">
        <button id="menuToggle" class="menu-toggle" onclick="toggleMenu(event)" aria-label="Alternar menu" aria-expanded="false">‚ò∞</button>
        <div class="header-info">
            <div class="user-info">
                <span class="user-name">@Model.UsuarioNome</span>
                <form action="@Url.Action("Logout", "Login")" method="post" class="logout-form">
                    @Html.AntiForgeryToken()
                    <button type="submit" class="logout-button" aria-label="Encerrar sess√£o"> Sair </button>
                </form>
            </div>
        </div>
    </div>

    <div class="menu-modal" id="menuModal" role="menu" aria-labelledby="menuToggle">
        <div class="menu-card">
            <div class="menu-header">
                <span class="menu-title">Navega√ß√£o r√°pida</span>
                <small>Selecione uma √°rea para continuar</small>
            </div>
            <div class="menu-grid">
                <button type="button" class="menu-item" data-open-tab data-tab="Usu√°rios" data-url='@Url.Action("Index", "Usuarios")'>
                    <span class="menu-icon">üë•</span>
                    <div class="menu-text">
                        <strong>Usu√°rios</strong>
                        <small>Gerencie os profissionais do portal</small>
                    </div>
                </button>
                <button type="button" class="menu-item" data-open-tab data-tab="Pacientes" data-url='@Url.Action("Index", "Pacientes")'>
                    <span class="menu-icon">‚ù§Ô∏è</span>
                    <div class="menu-text">
                        <strong>Pacientes</strong>
                        <small>Acompanhe os moradores cadastrados</small>
                    </div>
                </button>
                <button type="button" class="menu-item" data-open-tab data-tab="Campos" data-url='@Url.Action("Index", "Campos")'>
                    <span class="menu-icon">‚úèÔ∏è</span>
                    <div class="menu-text">
                        <strong>Campos</strong>
                        <small>Configure perguntas reutiliz√°veis</small>
                    </div>
                </button>
                <button type="button" class="menu-item" data-open-tab data-tab="Formul√°rios" data-url='@Url.Action("Index", "Formularios")'>
                    <span class="menu-icon">üìù</span>
                    <div class="menu-text">
                        <strong>Formul√°rios</strong>
                        <small>Monte instrumentos de avalia√ß√£o</small>
                    </div>
                </button>
                <button type="button" class="menu-item" data-open-tab data-tab="Gr√°ficos" data-url='@Url.Action("Index", "Graficos")'>
                    <span class="menu-icon">üìä</span>
                    <div class="menu-text">
                        <strong>Gr√°ficos</strong>
                        <small>Visualize indicadores importantes</small>
                    </div>
                </button>
                <button type="button" class="menu-item" data-open-tab data-tab="Dashboard" data-url='@Url.Action("Index", "Dashboard")'>
                    <span class="menu-icon">üìã</span>
                    <div class="menu-text">
                        <strong>Dashboard</strong>
                        <small>Acesse atalhos e relat√≥rios</small>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <div class="body-content">
        <div class="main-content">
            <div class="tabs" id="abas">
                <div class="aba active" id="aba-Portal" onclick="ativarConteudo('Portal')">Portal</div>
            </div>

            <div class="conteudos" id="conteudos">
                <div class="conteudo active" id="conteudo-Portal" data-refresh-url='@Url.Action("PortalResumo", "Home")'>
                    @await Html.PartialAsync("_PortalResumo", Model)
                </div>

                <div class="conteudo" id="conteudo-Usuarios">
                    <div class="panel-header">
                        <h3>Usu√°rios recentes</h3>
                        @if (User.IsInRole("Administrador"))
                        {
                            <a asp-controller="Usuarios" asp-action="Create" class="btn-link" data-open-tab data-tab="Usu√°rios" data-url='@Url.Action("Create", "Usuarios")'>Novo usu√°rio</a>
                        }
                        <a asp-controller="Usuarios" asp-action="Index" class="btn-link" data-open-tab data-tab="Usu√°rios" data-url='@Url.Action("Index", "Usuarios")'>Ver lista completa</a>
                    </div>

                    @if (!Model.UsuariosRecentes.Any())
                    {
                        <p class="empty-state">Nenhum usu√°rio cadastrado.</p>
                    }
                    else
                    {
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>C√≥digo</th>
                                        <th>Usu√°rio</th>
                                        <th>E-mail</th>
                                        <th>Perfil</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                @foreach (var usuario in Model.UsuariosRecentes)
                                {
                                    <tr>
                                        <td>@usuario.UsuarioId</td>
                                        <td>
                                            <div class="table-avatar">
                                                <img src="@(string.IsNullOrWhiteSpace(usuario.ImagemPerfil) ? Url.Content("~/images/avatar-generico.svg") : usuario.ImagemPerfil)"
                                                     alt="Foto de @usuario.NomeCompleto"
                                                     class="avatar avatar-sm" />
                                                <div class="table-avatar__info">
                                                    <strong>@usuario.NomeCompleto</strong>
                                                </div>
                                            </div>
                                        </td>
                                        <td>@usuario.Email</td>
                                        <td>@usuario.Perfil</td>
                                        <td>
                                            <span class="status-badge @(usuario.Ativo ? "success" : "danger")">
                                                @(usuario.Ativo ? "Ativo" : "Inativo")
                                            </span>
                                        </td>
                                    </tr>
                                }
                                </tbody>
                            </table>
                        </div>
                    }
                </div>

                <div class="conteudo" id="conteudo-Pacientes">
                    <div class="panel-header">
                        <h3>Pacientes cadastrados</h3>
                        <a asp-controller="Pacientes" asp-action="Create" class="btn-link" data-open-tab data-tab="Pacientes" data-url='@Url.Action("Create", "Pacientes")'>Novo paciente</a>
                        <a asp-controller="Pacientes" asp-action="Index" class="btn-link" data-open-tab data-tab="Pacientes" data-url='@Url.Action("Index", "Pacientes")'>Ver lista</a>
                    </div>

                    @if (!Model.PacientesRecentes.Any())
                    {
                        <p class="empty-state">Nenhum paciente cadastrado.</p>
                    }
                    else
                    {
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>C√≥digo</th>
                                        <th>Paciente</th>
                                        <th>Idade</th>
                                        <th>Respons√°vel</th>
                                        <th>√öltima atualiza√ß√£o</th>
                                    </tr>
                                </thead>
                                <tbody>
                                @foreach (var paciente in Model.PacientesRecentes)
                                {
                                    <tr>
                                        <td>@paciente.PacienteId</td>
                                        <td>
                                            <div class="table-avatar">
                                                <img src="@(string.IsNullOrWhiteSpace(paciente.ImagemPerfil) ? Url.Content("~/images/avatar-generico.svg") : paciente.ImagemPerfil)"
                                                     alt="Foto de @paciente.NomeCompleto"
                                                     class="avatar avatar-sm" />
                                                <div class="table-avatar__info">
                                                    <strong>@paciente.NomeCompleto</strong>
                                                    <small class="table-avatar__meta">@paciente.GeneroDescricao</small>
                                                </div>
                                            </div>
                                        </td>
                                        <td>@paciente.Idade anos</td>
                                        <td>@(string.IsNullOrEmpty(paciente.Responsavel) ? "-" : paciente.Responsavel)</td>
                                        <td>@paciente.DataCadastro.ToString("dd/MM/yyyy")</td>
                                    </tr>
                                }
                                </tbody>
                            </table>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>