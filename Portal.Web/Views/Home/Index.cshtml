@model GestaoSaudeIdosos.Web.ViewModels.DashboardViewModel
@{
    ViewData["Title"] = "Home";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="layout-container">
    <div class="header">
        <button id="menuToggle" class="menu-toggle" onclick="toggleMenu(event)" aria-label="Alternar menu" aria-expanded="false">‚ò∞</button>
        <div class="header-info">
            <span>Portal Gest√£o Idosos</span>
            <div class="user-info">
                <span class="user-name">@Model.UsuarioNome</span>
                <form asp-controller="Login" asp-action="Logout" method="post" class="logout-form">
                    @Html.AntiForgeryToken()
                    <button type="submit" class="btn-link logout-button" aria-label="Encerrar sess√£o">Sair</button>
                </form>
            </div>
        </div>
    </div>

    <div class="menu-modal" id="menuModal" role="menu" aria-labelledby="menuToggle">
        <div class="menu-card">
            <div class="menu-header">
                <span class="menu-title">Navega√ß√£o r√°pida</span>
                <small>Selecione uma √°rea para continuar</small>
            </div>
            <div class="menu-grid">
                <button type="button" class="menu-item" data-open-tab data-tab="Usu√°rios" data-url='@Url.Action("Index", "Usuarios")'>
                    <span class="menu-icon">üë•</span>
                    <div class="menu-text">
                        <strong>Usu√°rios</strong>
                        <small>Gerencie os profissionais do portal</small>
                    </div>
                </button>
                <button type="button" class="menu-item" data-open-tab data-tab="Pacientes" data-url='@Url.Action("Index", "Pacientes")'>
                    <span class="menu-icon">‚ù§Ô∏è</span>
                    <div class="menu-text">
                        <strong>Pacientes</strong>
                        <small>Acompanhe os moradores cadastrados</small>
                    </div>
                </button>
                <button type="button" class="menu-item" data-open-tab data-tab="Campos" data-url='@Url.Action("Index", "Campos")'>
                    <span class="menu-icon">‚úèÔ∏è</span>
                    <div class="menu-text">
                        <strong>Campos</strong>
                        <small>Configure perguntas reutiliz√°veis</small>
                    </div>
                </button>
                <button type="button" class="menu-item" data-open-tab data-tab="Formul√°rios" data-url='@Url.Action("Index", "Formularios")'>
                    <span class="menu-icon">üìù</span>
                    <div class="menu-text">
                        <strong>Formul√°rios</strong>
                        <small>Monte instrumentos de avalia√ß√£o</small>
                    </div>
                </button>
                <button type="button" class="menu-item" data-open-tab data-tab="Gr√°ficos" data-url='@Url.Action("Index", "Graficos")'>
                    <span class="menu-icon">üìä</span>
                    <div class="menu-text">
                        <strong>Gr√°ficos</strong>
                        <small>Visualize indicadores importantes</small>
                    </div>
                </button>
                <button type="button" class="menu-item" data-open-tab data-tab="Dashboard" data-url='@Url.Action("Index", "Dashboard")'>
                    <span class="menu-icon">üìã</span>
                    <div class="menu-text">
                        <strong>Dashboard</strong>
                        <small>Acesse atalhos e relat√≥rios</small>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <div class="body-content">
        <div class="main-content">
            <div class="tabs" id="abas">
                <div class="aba active" id="aba-Portal" onclick="ativarConteudo('Portal')">Portal</div>
            </div>

            <div class="conteudos" id="conteudos">
                <div class="conteudo active" id="conteudo-Portal">
                    <h2>Painel geral</h2>
                    <p>Resumo das principais informa√ß√µes para apoiar a preven√ß√£o de doen√ßas em idosos institucionalizados.</p>

                    <div class="dashboard-cards">
                        <div class="card">
                            <span class="card-title">Pacientes</span>
                            <strong>@Model.TotalPacientes</strong>
                            <small>Total de pacientes cadastrados</small>
                        </div>
                        <div class="card">
                            <span class="card-title">Usu√°rios</span>
                            <strong>@Model.TotalUsuarios</strong>
                            <small>Profissionais com acesso</small>
                        </div>
                        <div class="card">
                            <span class="card-title">Formul√°rios ativos</span>
                            <strong>@Model.FormulariosAtivos</strong>
                            <small>Instrumentos prontos para uso</small>
                        </div>
                        <div class="card @(Model.AlertasAtivos > 0 ? "alert" : string.Empty)">
                            <span class="card-title">Alertas</span>
                            <strong>@Model.AlertasAtivos</strong>
                            <small>Riscos que demandam aten√ß√£o</small>
                        </div>
                    </div>

                    <div class="quick-actions">
                        <a class="quick-card" asp-controller="Pacientes" asp-action="Create" data-open-tab data-tab="Novo paciente" data-url='@Url.Action("Create", "Pacientes")'>
                            <span>Adicionar paciente</span>
                            <small>Cadastre idosos e vincule respons√°veis</small>
                        </a>
                        <a class="quick-card" asp-controller="Campos" asp-action="Index" data-open-tab data-tab="Campos" data-url='@Url.Action("Index", "Campos")'>
                            <span>Configurar campos</span>
                            <small>Personalize perguntas reutiliz√°veis</small>
                        </a>
                        <a class="quick-card" asp-controller="Formularios" asp-action="Index" data-open-tab data-tab="Formularios" data-url='@Url.Action("Index", "Formularios")'>
                            <span>Montar formul√°rio</span>
                            <small>Combine campos para avalia√ß√µes</small>
                        </a>
                        <a class="quick-card" asp-controller="Graficos" asp-action="Index" data-open-tab data-tab="Graficos" data-url='@Url.Action("Index", "Graficos")'>
                            <span>Explorar gr√°ficos</span>
                            <small>Visualize indicadores dos pacientes</small>
                        </a>
                    </div>

                    <div class="grid-two-columns">
                        <section class="panel">
                            <div class="panel-header">
                                <h3>Formul√°rios recentes</h3>
                                <a asp-controller="Pacientes" asp-action="Create" class="btn-link" data-open-tab data-tab="Novo paciente" data-url='@Url.Action("Create", "Pacientes")'>Aplicar formul√°rio</a>
                            </div>

                            @if (!Model.FormulariosRecentes.Any())
                            {
                                <p class="empty-state">Nenhum formul√°rio cadastrado.</p>
                            }
                            else
                            {
                                <ul class="list">
                                @foreach (var form in Model.FormulariosRecentes)
                                {
                                    <li>
                                        <strong>@form.Descricao</strong>
                                        <span>@form.CamposTotais campo(s) ‚Ä¢ @form.PacientesAssociados paciente(s)</span>
                                        <small>Criado em @form.DataCadastro.ToString("dd/MM/yyyy")</small>
                                    </li>
                                }
                                </ul>
                            }
                        </section>

                        <section class="panel">
                            <div class="panel-header">
                                <h3>Relat√≥rios e sugest√µes</h3>
                                <a asp-controller="Pacientes" asp-action="Index" class="btn-link">Ver todos</a>
                            </div>

                            @if (!Model.Relatorios.Any())
                            {
                                <p class="empty-state">Nenhum relat√≥rio dispon√≠vel.</p>
                            }
                            else
                            {
                                <ul class="list">
                                @foreach (var relatorio in Model.Relatorios)
                                {
                                    <li>
                                        <div class="list-title">
                                            <strong>@relatorio.PacienteNome</strong>
                                            <span class="status-badge @(relatorio.NivelRisco.ToLower() == "alto" ? "danger" : relatorio.NivelRisco.ToLower() == "moderado" ? "warning" : "success")">@relatorio.NivelRisco</span>
                                        </div>
                                        <span>@relatorio.Resumo</span>
                                        <small>@relatorio.Sugestao</small>
                                    </li>
                                }
                                </ul>
                            }
                        </section>
                    </div>
                </div>

                <div class="conteudo" id="conteudo-Usuarios">
                    <div class="panel-header">
                        <h3>Usu√°rios recentes</h3>
                        @if (User.IsInRole("Administrador"))
                        {
                            <a asp-controller="Usuarios" asp-action="Create" class="btn-link" data-open-tab data-tab="Novo usu√°rio" data-url='@Url.Action("Create", "Usuarios")'>Novo usu√°rio</a>
                        }
                        <a asp-controller="Usuarios" asp-action="Index" class="btn-link" data-open-tab data-tab="Usu√°rios" data-url='@Url.Action("Index", "Usuarios")'>Ver lista completa</a>
                    </div>

                    @if (!Model.UsuariosRecentes.Any())
                    {
                        <p class="empty-state">Nenhum usu√°rio cadastrado.</p>
                    }
                    else
                    {
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Nome</th>
                                        <th>E-mail</th>
                                        <th>Perfil</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                @foreach (var usuario in Model.UsuariosRecentes)
                                {
                                    <tr>
                                        <td>@usuario.Nome</td>
                                        <td>@usuario.Email</td>
                                        <td>@usuario.Perfil</td>
                                        <td>
                                            <span class="status-badge @(usuario.Ativo ? "success" : "danger")">
                                                @(usuario.Ativo ? "Ativo" : "Inativo")
                                            </span>
                                        </td>
                                    </tr>
                                }
                                </tbody>
                            </table>
                        </div>
                    }
                </div>

                <div class="conteudo" id="conteudo-Pacientes">
                    <div class="panel-header">
                        <h3>Pacientes cadastrados</h3>
                        <a asp-controller="Pacientes" asp-action="Create" class="btn-link" data-open-tab data-tab="Novo paciente" data-url='@Url.Action("Create", "Pacientes")'>Novo paciente</a>
                        <a asp-controller="Pacientes" asp-action="Index" class="btn-link" data-open-tab data-tab="Pacientes" data-url='@Url.Action("Index", "Pacientes")'>Ver lista</a>
                    </div>

                    @if (!Model.PacientesRecentes.Any())
                    {
                        <p class="empty-state">Nenhum paciente cadastrado.</p>
                    }
                    else
                    {
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Nome</th>
                                        <th>Idade</th>
                                        <th>Respons√°vel</th>
                                        <th>√öltima atualiza√ß√£o</th>
                                    </tr>
                                </thead>
                                <tbody>
                                @foreach (var paciente in Model.PacientesRecentes)
                                {
                                    <tr>
                                        <td>@paciente.Nome</td>
                                        <td>@paciente.Idade anos</td>
                                        <td>@(string.IsNullOrEmpty(paciente.Responsavel) ? "-" : paciente.Responsavel)</td>
                                        <td>@paciente.DataCadastro.ToString("dd/MM/yyyy")</td>
                                    </tr>
                                }
                                </tbody>
                            </table>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>