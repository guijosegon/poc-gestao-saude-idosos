@using System;
@using System.Linq;
@model GestaoSaudeIdosos.Web.ViewModels.DashboardViewModel

@{
    var relatoriosAltoRisco = Model.Relatorios
        .Where(relatorio => string.Equals(relatorio.NivelRisco, "Alto", StringComparison.OrdinalIgnoreCase))
        .ToList();
    var alertasCriticos = relatoriosAltoRisco.Count;
    var pacientesRecentes = Model.PacientesRecentes.Take(4).ToList();
    var usuariosRecentes = Model.UsuariosRecentes.Take(4).ToList();
}

<section class="dashboard-hero">
    <div class="dashboard-hero__title">
        <h2>Painel geral</h2>
        <p>Resumo das principais informa√ß√µes para apoiar a preven√ß√£o de doen√ßas em idosos institucionalizados.</p>
    </div>
</section>

<div class="summary-grid">
    <article class="summary-card">
        <header>
            <span class="summary-icon" aria-hidden="true">üëµ</span>
            <span class="summary-label">Pacientes monitorados</span>
        </header>
        <strong class="summary-value">@Model.TotalPacientes</strong>
        <span class="summary-extra">@pacientesRecentes.Count paciente(s) rec√©m-adicionado(s)</span>
    </article>
    <article class="summary-card">
        <header>
            <span class="summary-icon" aria-hidden="true">üßë‚Äç‚öïÔ∏è</span>
            <span class="summary-label">Usu√°rios ativos</span>
        </header>
        <strong class="summary-value">@Model.TotalUsuarios</strong>
        <span class="summary-extra">@usuariosRecentes.Count novo(s) acesso(s) registrado(s)</span>
    </article>
    <article class="summary-card">
        <header>
            <span class="summary-icon" aria-hidden="true">üìù</span>
            <span class="summary-label">Formul√°rios ativos</span>
        </header>
        <strong class="summary-value">@Model.FormulariosAtivos</strong>
        <span class="summary-extra">Ferramentas prontas para avalia√ß√£o</span>
    </article>
    <article class="summary-card @(alertasCriticos > 0 ? "has-alert" : string.Empty)">
        <header>
            <span class="summary-icon" aria-hidden="true">‚ö†Ô∏è</span>
            <span class="summary-label">Alertas cr√≠ticos</span>
        </header>
        <strong class="summary-value">@alertasCriticos</strong>
        <span class="summary-extra">Somente riscos classificados como alto</span>
    </article>
</div>

<section class="content-block">
    <header class="content-block__header">
        <h3>Indicadores gr√°ficos</h3>
        <span>Os gr√°ficos em tempo real ser√£o carregados automaticamente via Google Charts.</span>
    </header>
    <div id="portal-dashboard-charts" class="content-block__charts" data-gcharts-root>
        <span class="placeholder-icon" aria-hidden="true">üìä</span>
        <p>Quando configurado pelo cliente, os gr√°ficos do Google Charts ser√£o renderizados neste espa√ßo.</p>
    </div>
</section>

<section class="content-block">
    <header class="content-block__header">
        <h3>A√ß√µes r√°pidas</h3>
        <span>Atalhos para navega√ß√£o imediata.</span>
    </header>
    <div class="quick-actions">
        <a class="quick-card" asp-controller="Pacientes" asp-action="Create" data-open-tab data-tab="Pacientes" data-url='@Url.Action("Create", "Pacientes")'>
            <span class="quick-icon" aria-hidden="true">‚ûï</span>
            <div>
                <span>Adicionar paciente</span>
                <small>Cadastre idosos e vincule respons√°veis</small>
            </div>
        </a>
        <a class="quick-card" asp-controller="Campos" asp-action="Index" data-open-tab data-tab="Campos" data-url='@Url.Action("Index", "Campos")'>
            <span class="quick-icon" aria-hidden="true">‚öôÔ∏è</span>
            <div>
                <span>Configurar campos</span>
                <small>Personalize perguntas reutiliz√°veis</small>
            </div>
        </a>
        <a class="quick-card" asp-controller="Formularios" asp-action="Index" data-open-tab data-tab="Formul√°rios" data-url='@Url.Action("Index", "Formularios")'>
            <span class="quick-icon" aria-hidden="true">üìÑ</span>
            <div>
                <span>Montar formul√°rio</span>
                <small>Combine campos para avalia√ß√µes</small>
            </div>
        </a>
        <a class="quick-card" asp-controller="Graficos" asp-action="Index" data-open-tab data-tab="Gr√°ficos" data-url='@Url.Action("Index", "Graficos")'>
            <span class="quick-icon" aria-hidden="true">üìà</span>
            <div>
                <span>Explorar gr√°ficos</span>
                <small>Visualize indicadores dos pacientes</small>
            </div>
        </a>
    </div>
</section>

<div class="dashboard-panels">
    <section class="content-block">
        <header class="content-block__header">
            <h3>Formul√°rios recentes</h3>
            <a asp-controller="Pacientes" asp-action="Create" class="btn-link" data-open-tab data-tab="Pacientes" data-url='@Url.Action("Create", "Pacientes")'>Aplicar formul√°rio</a>
        </header>

        @if (!Model.FormulariosRecentes.Any())
        {
            <p class="empty-state">Nenhum formul√°rio cadastrado.</p>
        }
        else
        {
            <ul class="list list-divided">
            @foreach (var form in Model.FormulariosRecentes)
            {
                <li>
                    <strong>@form.Descricao</strong>
                    <span>@form.CamposTotais campo(s) ‚Ä¢ @form.PacientesAssociados paciente(s)</span>
                    <small>Criado em @form.DataCadastro.ToString("dd/MM/yyyy")</small>
                </li>
            }
            </ul>
        }
    </section>

    <section class="content-block content-block--alerts">
        <header class="content-block__header">
            <h3>Alertas de alto risco</h3>
            <a asp-controller="Pacientes" asp-action="Index" class="btn-link">Ver todos</a>
        </header>

        @if (!relatoriosAltoRisco.Any())
        {
            <p class="empty-state">Nenhum alerta cr√≠tico no momento.</p>
        }
        else
        {
            <ul class="alert-list">
            @foreach (var relatorio in relatoriosAltoRisco)
            {
                <li class="alert-card">
                    <div class="alert-card__title">
                        <strong>@relatorio.PacienteNome</strong>
                        <span class="status-badge danger">@relatorio.NivelRisco</span>
                    </div>
                    <div class="alert-card__field">
                        <span class="field-label">Resumo</span>
                        <p>@relatorio.Resumo</p>
                    </div>
                    <div class="alert-card__field">
                        <span class="field-label">Recomenda√ß√£o</span>
                        <p class="field-recommendation">@relatorio.Sugestao</p>
                    </div>
                </li>
            }
            </ul>
        }
    </section>

    <section class="content-block">
        <header class="content-block__header">
            <h3>Novos cadastros</h3>
        </header>

        <div class="new-records">
            <div class="new-records__column">
                <h4>Pacientes recentes</h4>
                @if (!pacientesRecentes.Any())
                {
                    <p class="empty-state">Sem novos pacientes cadastrados.</p>
                }
                else
                {
                    <ul class="list list-divided compact">
                    @foreach (var paciente in pacientesRecentes)
                    {
                        <li>
                            <strong>@paciente.NomeCompleto</strong>
                            <small>Idade @paciente.Idade anos</small>
                        </li>
                    }
                    </ul>
                }
            </div>
            <div class="new-records__divider"></div>
            <div class="new-records__column">
                <h4>Usu√°rios recentes</h4>
                @if (!usuariosRecentes.Any())
                {
                    <p class="empty-state">Sem novos usu√°rios cadastrados.</p>
                }
                else
                {
                    <ul class="list list-divided compact">
                    @foreach (var usuario in usuariosRecentes)
                    {
                        <li>
                            <strong>@usuario.NomeCompleto</strong>
                            <small>@usuario.Email</small>
                        </li>
                    }
                    </ul>
                }
            </div>
        </div>
    </section>
</div>
