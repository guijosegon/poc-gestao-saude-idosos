@using System;
@using System.Linq;
@model GestaoSaudeIdosos.Web.ViewModels.DashboardViewModel

@{
    var relatoriosAltoRisco = Model.Relatorios
        .Where(relatorio => string.Equals(relatorio.NivelRisco, "Alto", StringComparison.OrdinalIgnoreCase))
        .ToList();
    var alertasCriticos = relatoriosAltoRisco.Count;
    var pacientesRecentes = Model.PacientesRecentes.Take(4).ToList();
    var usuariosRecentes = Model.UsuariosRecentes.Take(4).ToList();
}

<header class="dashboard-header">
    <div>
        <h2>Painel geral</h2>
        <p>Resumo das principais informa√ß√µes para apoiar a preven√ß√£o de doen√ßas em idosos institucionalizados.</p>
    </div>
</header>

<div class="dashboard-cards">
    <article class="stat-card">
        <span class="stat-icon" aria-hidden="true">üëµ</span>
        <div>
            <span class="stat-label">Pacientes monitorados</span>
            <strong>@Model.TotalPacientes</strong>
            <small>@pacientesRecentes.Count paciente(s) rec√©m-adicionado(s)</small>
        </div>
    </article>
    <article class="stat-card">
        <span class="stat-icon" aria-hidden="true">üßë‚Äç‚öïÔ∏è</span>
        <div>
            <span class="stat-label">Usu√°rios ativos</span>
            <strong>@Model.TotalUsuarios</strong>
            <small>@usuariosRecentes.Count novo(s) acesso(s) registrado(s)</small>
        </div>
    </article>
    <article class="stat-card">
        <span class="stat-icon" aria-hidden="true">üìù</span>
        <div>
            <span class="stat-label">Formul√°rios ativos</span>
            <strong>@Model.FormulariosAtivos</strong>
            <small>Ferramentas prontas para avalia√ß√£o</small>
        </div>
    </article>
    <article class="stat-card @(alertasCriticos > 0 ? "critical" : string.Empty)">
        <span class="stat-icon" aria-hidden="true">‚ö†Ô∏è</span>
        <div>
            <span class="stat-label">Alertas cr√≠ticos</span>
            <strong>@alertasCriticos</strong>
            <small>Somente riscos classificados como alto</small>
        </div>
    </article>
</div>

<section class="charts-wrapper">
    <div class="panel-header">
        <h3>Indicadores gr√°ficos</h3>
        <span class="charts-hint">Os gr√°ficos em tempo real ser√£o carregados automaticamente via Google Charts.</span>
    </div>
    <div id="portal-dashboard-charts" class="charts-placeholder" data-gcharts-root>
        <span class="placeholder-icon" aria-hidden="true">üìä</span>
        <p>Quando configurado pelo cliente, os gr√°ficos do Google Charts ser√£o renderizados neste espa√ßo.</p>
    </div>
</section>

<div class="quick-actions">
    <a class="quick-card" asp-controller="Pacientes" asp-action="Create" data-open-tab data-tab="Pacientes" data-url='@Url.Action("Create", "Pacientes")'>
        <span class="quick-icon" aria-hidden="true">‚ûï</span>
        <div>
            <span>Adicionar paciente</span>
            <small>Cadastre idosos e vincule respons√°veis</small>
        </div>
    </a>
    <a class="quick-card" asp-controller="Campos" asp-action="Index" data-open-tab data-tab="Campos" data-url='@Url.Action("Index", "Campos")'>
        <span class="quick-icon" aria-hidden="true">‚öôÔ∏è</span>
        <div>
            <span>Configurar campos</span>
            <small>Personalize perguntas reutiliz√°veis</small>
        </div>
    </a>
    <a class="quick-card" asp-controller="Formularios" asp-action="Index" data-open-tab data-tab="Formul√°rios" data-url='@Url.Action("Index", "Formularios")'>
        <span class="quick-icon" aria-hidden="true">üìÑ</span>
        <div>
            <span>Montar formul√°rio</span>
            <small>Combine campos para avalia√ß√µes</small>
        </div>
    </a>
    <a class="quick-card" asp-controller="Graficos" asp-action="Index" data-open-tab data-tab="Gr√°ficos" data-url='@Url.Action("Index", "Graficos")'>
        <span class="quick-icon" aria-hidden="true">üìà</span>
        <div>
            <span>Explorar gr√°ficos</span>
            <small>Visualize indicadores dos pacientes</small>
        </div>
    </a>
</div>

<div class="dashboard-panels">
    <section class="panel">
        <div class="panel-header">
            <h3>Formul√°rios recentes</h3>
            <a asp-controller="Pacientes" asp-action="Create" class="btn-link" data-open-tab data-tab="Pacientes" data-url='@Url.Action("Create", "Pacientes")'>Aplicar formul√°rio</a>
        </div>

        @if (!Model.FormulariosRecentes.Any())
        {
            <p class="empty-state">Nenhum formul√°rio cadastrado.</p>
        }
        else
        {
            <ul class="list">
            @foreach (var form in Model.FormulariosRecentes)
            {
                <li>
                    <strong>@form.Descricao</strong>
                    <span>@form.CamposTotais campo(s) ‚Ä¢ @form.PacientesAssociados paciente(s)</span>
                    <small>Criado em @form.DataCadastro.ToString("dd/MM/yyyy")</small>
                </li>
            }
            </ul>
        }
    </section>

    <section class="panel panel-alerts">
        <div class="panel-header">
            <h3>Alertas de alto risco</h3>
            <a asp-controller="Pacientes" asp-action="Index" class="btn-link">Ver todos</a>
        </div>

        @if (!relatoriosAltoRisco.Any())
        {
            <p class="empty-state">Nenhum alerta cr√≠tico no momento.</p>
        }
        else
        {
            <ul class="list">
            @foreach (var relatorio in relatoriosAltoRisco)
            {
                <li>
                    <div class="list-title">
                        <strong>@relatorio.PacienteNome</strong>
                        <span class="status-badge danger">@relatorio.NivelRisco</span>
                    </div>
                    <span>@relatorio.Resumo</span>
                    <small>@relatorio.Sugestao</small>
                </li>
            }
            </ul>
        }
    </section>

    <section class="panel">
        <div class="panel-header">
            <h3>Novos cadastros</h3>
        </div>

        <div class="split-list">
            <div>
                <h4>Pacientes recentes</h4>
                @if (!pacientesRecentes.Any())
                {
                    <p class="empty-state">Sem novos pacientes cadastrados.</p>
                }
                else
                {
                    <ul class="list compact">
                    @foreach (var paciente in pacientesRecentes)
                    {
                        <li>
                            <strong>@paciente.NomeCompleto</strong>
                            <small>Idade @paciente.Idade anos</small>
                        </li>
                    }
                    </ul>
                }
            </div>
            <div>
                <h4>Usu√°rios recentes</h4>
                @if (!usuariosRecentes.Any())
                {
                    <p class="empty-state">Sem novos usu√°rios cadastrados.</p>
                }
                else
                {
                    <ul class="list compact">
                    @foreach (var usuario in usuariosRecentes)
                    {
                        <li>
                            <strong>@usuario.NomeCompleto</strong>
                            <small>@usuario.Email</small>
                        </li>
                    }
                    </ul>
                }
            </div>
        </div>
    </section>
</div>
